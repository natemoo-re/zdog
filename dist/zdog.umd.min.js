/**
 * Zdog v1.0.1
 * Round, flat, designer-friendly pseudo-3D engine
 * Licensed MIT
 * https://zzz.dog
 * Copyright 2019 Metafizzy
 */

!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).Zdog=e()}(this,function(){"use strict";const t=2*Math.PI,e=function(){},i=function(t,e){for(var i in e)t[i]=e[i];return t},r=function(t,e,i){return(e-t)*i+t},n=function(t,e){return(t%e+e)%e},o={2:function(t){return t*t},3:function(t){return t*t*t},4:function(t){return t*t*t*t},5:function(t){return t*t*t*t*t}};var s={isCanvas:!0,begin:function(t){t.beginPath()},move:function(t,e,i){t.moveTo(i.x,i.y)},line:function(t,e,i){t.lineTo(i.x,i.y)},bezier:function(t,e,i,r,n){t.bezierCurveTo(i.x,i.y,r.x,r.y,n.x,n.y)},closePath:function(t){t.closePath()},setPath:function(){},renderPath:function(t,e,i,r){this.begin(t,e),i.forEach(function(i){i.render(t,e,s)}),r&&this.closePath(t,e)},stroke:function(t,e,i,r,n){i&&(t.strokeStyle=r,t.lineWidth=n,t.stroke())},fill:function(t,e,i,r){i&&(t.fillStyle=r,t.fill())},end:function(){}},h={isSvg:!0},a=h.round=function(t){return Math.round(1e3*t)/1e3};function p(t){return a(t.x)+","+a(t.y)+" "}function d(t){this.set(t)}function c(e,i,r,n){if(i&&i%t!=0){var o=Math.cos(i),s=Math.sin(i),h=e[r],a=e[n];e[r]=h*o-a*s,e[n]=a*o+h*s}}function u(t){return Math.abs(t-1)<1e-8?1:Math.sqrt(t)}h.begin=function(){},h.move=function(t,e,i){return"M"+p(i)},h.line=function(t,e,i){return"L"+p(i)},h.bezier=function(t,e,i,r,n){return"C"+p(i)+p(r)+p(n)},h.closePath=function(){return"Z"},h.setPath=function(t,e,i){e.setAttribute("d",i)},h.renderPath=function(t,e,i,r){var n="";i.forEach(function(i){n+=i.render(t,e,h)}),r&&(n+=this.closePath(t,e)),this.setPath(t,e,n)},h.stroke=function(t,e,i,r,n){i&&(e.setAttribute("stroke",r),e.setAttribute("stroke-width",n))},h.fill=function(t,e,i,r){var n=i?r:"none";e.setAttribute("fill",n)},h.end=function(t,e){t.appendChild(e)},d.prototype.set=function(t){return this.x=t&&t.x||0,this.y=t&&t.y||0,this.z=t&&t.z||0,this},d.prototype.write=function(t){return t?(this.x=null!=t.x?t.x:this.x,this.y=null!=t.y?t.y:this.y,this.z=null!=t.z?t.z:this.z,this):this},d.prototype.rotate=function(t){if(t)return this.rotateZ(t.z),this.rotateY(t.y),this.rotateX(t.x),this},d.prototype.rotateZ=function(t){c(this,t,"x","y")},d.prototype.rotateX=function(t){c(this,t,"y","z")},d.prototype.rotateY=function(t){c(this,t,"x","z")},d.prototype.add=function(t){return t?(this.x+=t.x||0,this.y+=t.y||0,this.z+=t.z||0,this):this},d.prototype.subtract=function(t){return t?(this.x-=t.x||0,this.y-=t.y||0,this.z-=t.z||0,this):this},d.prototype.multiply=function(t){return null==t?this:("number"==typeof t?(this.x*=t,this.y*=t,this.z*=t):(this.x*=null!=t.x?t.x:1,this.y*=null!=t.y?t.y:1,this.z*=null!=t.z?t.z:1),this)},d.prototype.transform=function(t,e,i){return this.multiply(i),this.rotate(e),this.add(t),this},d.prototype.lerp=function(t,e){return this.x=r(this.x,t.x||0,e),this.y=r(this.y,t.y||0,e),this.z=r(this.z,t.z||0,e),this},d.prototype.magnitude=function(){return u(this.x*this.x+this.y*this.y+this.z*this.z)},d.prototype.magnitude2d=function(){return u(this.x*this.x+this.y*this.y)},d.prototype.copy=function(){return new d(this)};const l={x:1,y:1,z:1};function f(t){this.create(t||{})}f.prototype.create=function(t){i(this,this.constructor.defaults),this.setOptions(t),this.translate=new d(t.translate),this.rotate=new d(t.rotate),this.scale=new d(l).multiply(this.scale),this.origin=new d,this.renderOrigin=new d,this.children=[],this.addTo&&this.addTo.addChild(this)},f.defaults={},f.optionKeys=Object.keys(f.defaults).concat(["rotate","translate","scale","addTo"]),f.prototype.setOptions=function(t){var e=this.constructor.optionKeys;for(var i in t)e.includes(i)&&(this[i]=t[i])},f.prototype.addChild=function(t){-1==this.children.indexOf(t)&&(t.remove(),t.addTo=this,this.children.push(t))},f.prototype.removeChild=function(t){var e=this.children.indexOf(t);-1!=e&&this.children.splice(e,1)},f.prototype.remove=function(){this.addTo&&this.addTo.removeChild(this)},f.prototype.update=function(){this.reset(),this.children.forEach(function(t){t.update()}),this.transform(this.translate,this.rotate,this.scale)},f.prototype.reset=function(){this.renderOrigin.set(this.origin)},f.prototype.transform=function(t,e,i){this.renderOrigin.transform(t,e,i),this.children.forEach(function(r){r.transform(t,e,i)})},f.prototype.updateGraph=function(){this.update(),this.checkFlatGraph(),this.flatGraph.forEach(function(t){t.updateSortValue()}),this.flatGraph.sort(f.shapeSorter)},f.shapeSorter=function(t,e){return t.sortValue-e.sortValue},f.prototype.checkFlatGraph=function(){this.flatGraph||this.updateFlatGraph()},f.prototype.updateFlatGraph=function(){this.flatGraph=this.getFlatGraph()},f.prototype.getFlatGraph=function(){var t=[this];return this.children.forEach(function(e){var i=e.getFlatGraph();t=t.concat(i)}),t},f.prototype.updateSortValue=function(){this.sortValue=this.renderOrigin.z},f.prototype.render=function(){},f.prototype.renderGraphCanvas=function(t){if(!t)throw new Error("ctx is "+t+". Canvas context required for render. Check .renderGraphCanvas( ctx ).");this.checkFlatGraph(),this.flatGraph.forEach(function(e){e.render(t,Zdog.CanvasRenderer)})},f.prototype.renderGraphSvg=function(t){if(!t)throw new Error("svg is "+t+". SVG required for render. Check .renderGraphSvg( svg ).");this.checkFlatGraph(),this.flatGraph.forEach(function(e){e.render(t,Zdog.SvgRenderer)})},f.prototype.copy=function(t){var e={};return this.constructor.optionKeys.forEach(function(t){e[t]=this[t]},this),i(e,t),new(0,this.constructor)(e)},f.prototype.copyGraph=function(t){var e=this.copy(t);return this.children.forEach(function(t){t.copyGraph({addTo:e})}),e},f.prototype.normalizeRotate=function(){this.rotate.x=n(this.rotate.x,t),this.rotate.y=n(this.rotate.y,t),this.rotate.z=n(this.rotate.z,t)},f.subclass=function t(e){return function(r){function n(t){this.create(t||{})}return n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.defaults=i({},e.defaults),i(n.defaults,r),n.optionKeys=e.optionKeys.slice(0),Object.keys(n.defaults).forEach(function(t){n.optionKeys.includes(t)||n.optionKeys.push(t)}),n.subclass=t(n),n}}(f);var y="mousedown",g="mousemove",v="mouseup";function m(t){this.create(t||{})}window.PointerEvent?(y="pointerdown",g="pointermove",v="pointerup"):"ontouchstart"in window&&(y="touchstart",g="touchmove",v="touchend"),m.prototype.create=function(t){this.onDragStart=t.onDragStart||e,this.onDragMove=t.onDragMove||e,this.onDragEnd=t.onDragEnd||e,this.bindDrag(t.startElement)},m.prototype.bindDrag=function(t){(t=this.getQueryElement(t))&&t.addEventListener(y,this)},m.prototype.getQueryElement=function(t){return"string"==typeof t&&(t=document.querySelector(t)),t},m.prototype.handleEvent=function(t){var e=this["on"+t.type];e&&e.call(this,t)},m.prototype.onmousedown=m.prototype.onpointerdown=function(t){this.dragStart(t,t)},m.prototype.ontouchstart=function(t){this.dragStart(t,t.changedTouches[0])},m.prototype.dragStart=function(t,e){t.preventDefault(),this.dragStartX=e.pageX,this.dragStartY=e.pageY,window.addEventListener(g,this),window.addEventListener(v,this),this.onDragStart(e)},m.prototype.ontouchmove=function(t){this.dragMove(t,t.changedTouches[0])},m.prototype.onmousemove=m.prototype.onpointermove=function(t){this.dragMove(t,t)},m.prototype.dragMove=function(t,e){t.preventDefault();var i=e.pageX-this.dragStartX,r=e.pageY-this.dragStartY;this.onDragMove(e,i,r)},m.prototype.onmouseup=m.prototype.onpointerup=m.prototype.ontouchend=m.prototype.dragEnd=function(){window.removeEventListener(g,this),window.removeEventListener(v,this),this.onDragEnd()};var w=f.subclass({element:void 0,centered:!0,zoom:1,dragRotate:!1,resize:!1,onPrerender:e,onDragStart:e,onDragMove:e,onDragEnd:e,onResize:e});function x(t,e,i){this.method=t,this.points=e.map(S),this.renderPoints=e.map(b),this.previousPoint=i,this.endRenderPoint=this.renderPoints[this.renderPoints.length-1],"arc"==t&&(this.controlPoints=[new d,new d])}function S(t){return t instanceof d?t:new d(t)}function b(t){return new d(t)}i(w.prototype,m.prototype),w.prototype.create=function(t){f.prototype.create.call(this,t),m.prototype.create.call(this,t),this.setElement(this.element),this.setDragRotate(this.dragRotate),this.setResize(this.resize)},w.prototype.setElement=function(t){if(!(t=this.getQueryElement(t)))throw new Error("Zdog.Illustration element required. Set to "+t);var e=t.nodeName.toLowerCase();"canvas"==e?this.setCanvas(t):"svg"==e&&this.setSvg(t)},w.prototype.setSize=function(t,e){t=Math.round(t),e=Math.round(e),this.isCanvas?this.setSizeCanvas(t,e):this.isSvg&&this.setSizeSvg(t,e)},w.prototype.setResize=function(t){this.resize=t,this.resizeListener||(this.resizeListener=this.onWindowResize.bind(this)),t?(window.addEventListener("resize",this.resizeListener),this.onWindowResize()):window.removeEventListener("resize",this.resizeListener)},w.prototype.onWindowResize=function(){this.setMeasuredSize(),this.onResize(this.width,this.height)},w.prototype.setMeasuredSize=function(){var t,e;if("fullscreen"==this.resize)t=window.innerWidth,e=window.innerHeight;else{var i=this.element.getBoundingClientRect();t=i.width,e=i.height}this.setSize(t,e)},w.prototype.renderGraph=function(t){this.isCanvas?this.renderGraphCanvas(t):this.isSvg&&this.renderGraphSvg(t)},w.prototype.updateRenderGraph=function(t){this.updateGraph(),this.renderGraph(t)},w.prototype.setCanvas=function(t){this.element=t,this.isCanvas=!0,this.ctx=this.element.getContext("2d"),this.setSizeCanvas(t.width,t.height)},w.prototype.setSizeCanvas=function(t,e){this.width=t,this.height=e;var i=this.pixelRatio=window.devicePixelRatio||1;this.element.width=this.canvasWidth=t*i,this.element.height=this.canvasHeight=e*i,i>1&&(this.element.style.width=t+"px",this.element.style.height=e+"px")},w.prototype.renderGraphCanvas=function(t){t=t||this,this.prerenderCanvas(),f.prototype.renderGraphCanvas.call(t,this.ctx),this.postrenderCanvas()},w.prototype.prerenderCanvas=function(){var t=this.ctx;if(t.lineCap="round",t.lineJoin="round",t.clearRect(0,0,this.canvasWidth,this.canvasHeight),t.save(),this.centered){var e=this.width/2*this.pixelRatio,i=this.height/2*this.pixelRatio;t.translate(e,i)}var r=this.pixelRatio*this.zoom;t.scale(r,r),this.onPrerender(t)},w.prototype.postrenderCanvas=function(){this.ctx.restore()},w.prototype.setSvg=function(t){this.element=t,this.isSvg=!0,this.pixelRatio=1;var e=t.getAttribute("width"),i=t.getAttribute("height");this.setSizeSvg(e,i)},w.prototype.setSizeSvg=function(t,e){this.width=t,this.height=e;var i=t/this.zoom,r=e/this.zoom,n=this.centered?-i/2:0,o=this.centered?-r/2:0;this.element.setAttribute("viewBox",n+" "+o+" "+i+" "+r),this.resize?(this.element.removeAttribute("width"),this.element.removeAttribute("height")):(this.element.setAttribute("width",t),this.element.setAttribute("height",e))},w.prototype.renderGraphSvg=function(t){t=t||this,function(t){for(;t.firstChild;)t.removeChild(t.firstChild)}(this.element),this.onPrerender(this.element),f.prototype.renderGraphSvg.call(t,this.element)},w.prototype.setDragRotate=function(t){t&&(!0===t&&(t=this),this.dragRotate=t,this.bindDrag(this.element))},w.prototype.dragStart=function(){this.dragStartRX=this.dragRotate.rotate.x,this.dragStartRY=this.dragRotate.rotate.y,m.prototype.dragStart.apply(this,arguments)},w.prototype.dragMove=function(e,i){var r=i.pageX-this.dragStartX,n=i.pageY-this.dragStartY,o=Math.min(this.width,this.height),s=r/o*t,h=n/o*t;this.dragRotate.rotate.x=this.dragStartRX-h,this.dragRotate.rotate.y=this.dragStartRY-s,m.prototype.dragMove.apply(this,arguments)},x.prototype.reset=function(){var t=this.points;this.renderPoints.forEach(function(e,i){var r=t[i];e.set(r)})},x.prototype.transform=function(t,e,i){this.renderPoints.forEach(function(r){r.transform(t,e,i)})},x.prototype.render=function(t,e,i){return this[this.method](t,e,i)},x.prototype.move=function(t,e,i){return i.move(t,e,this.renderPoints[0])},x.prototype.line=function(t,e,i){return i.line(t,e,this.renderPoints[0])},x.prototype.bezier=function(t,e,i){var r=this.renderPoints[0],n=this.renderPoints[1],o=this.renderPoints[2];return i.bezier(t,e,r,n,o)},x.prototype.arc=function(t,e,i){var r=this.previousPoint,n=this.renderPoints[0],o=this.renderPoints[1],s=this.controlPoints[0],h=this.controlPoints[1];return s.set(r).lerp(n,9/16),h.set(o).lerp(n,9/16),i.bezier(t,e,s,h,o)};var C=f.subclass({stroke:1,fill:!1,color:"#333",closed:!0,visible:!0,path:[{}],front:{z:1},backface:!0});C.prototype.create=function(t){f.prototype.create.call(this,t),this.updatePath(),this.front=new d(t.front||this.front),this.renderFront=new d(this.front),this.renderNormal=new d};var E=["move","line","bezier","arc"];C.prototype.updatePath=function(){this.setPath(),this.updatePathCommands()},C.prototype.setPath=function(){},C.prototype.updatePathCommands=function(){var t;this.pathCommands=this.path.map(function(e,i){var r=Object.keys(e),n=r[0],o=e[n];1==r.length&&E.includes(n)||(n="line",o=e);var s="line"==n||"move"==n,h=Array.isArray(o);s&&!h&&(o=[o]);var a=new x(n=0===i?"move":n,o,t);return t=a.endRenderPoint,a})},C.prototype.reset=function(){this.renderOrigin.set(this.origin),this.renderFront.set(this.front),this.pathCommands.forEach(function(t){t.reset()})},C.prototype.transform=function(t,e,i){this.renderOrigin.transform(t,e,i),this.renderFront.transform(t,e,i),this.renderNormal.set(this.renderOrigin).subtract(this.renderFront),this.pathCommands.forEach(function(r){r.transform(t,e,i)}),this.children.forEach(function(r){r.transform(t,e,i)})},C.prototype.updateSortValue=function(){var t=0;this.pathCommands.forEach(function(e){t+=e.endRenderPoint.z}),this.sortValue=t/this.pathCommands.length},C.prototype.render=function(t,e){var i=this.pathCommands.length;if(this.visible&&i&&(this.isFacingBack=this.renderNormal.z>0,this.backface||!this.isFacingBack)){if(!e)throw new Error("Zdog renderer required. Set to "+e);var r=1==i;e.isCanvas&&r?this.renderCanvasDot(t,e):this.renderPath(t,e)}},C.prototype.renderCanvasDot=function(e){var i=this.getLineWidth();if(i){e.fillStyle=this.getRenderColor();var r=this.pathCommands[0].endRenderPoint;e.beginPath();var n=i/2;e.arc(r.x,r.y,n,0,t),e.fill()}},C.prototype.getLineWidth=function(){return this.stroke?1==this.stroke?1:this.stroke:0},C.prototype.getRenderColor=function(){return"string"==typeof this.backface&&this.isFacingBack?this.backface:this.color},C.prototype.renderPath=function(t,e){var i=this.getRenderElement(t,e),r=!(2==this.pathCommands.length&&"line"==this.pathCommands[1].method)&&this.closed,n=this.getRenderColor();e.renderPath(t,i,this.pathCommands,r),e.stroke(t,i,this.stroke,n,this.getLineWidth()),e.fill(t,i,this.fill,n),e.end(t,i)};C.prototype.getRenderElement=function(t,e){if(e.isSvg)return this.svgElement||(this.svgElement=document.createElementNS("http://www.w3.org/2000/svg","path"),this.svgElement.setAttribute("stroke-linecap","round"),this.svgElement.setAttribute("stroke-linejoin","round")),this.svgElement};var z=f.subclass({updateSort:!1,visible:!0});z.prototype.updateSortValue=function(){var t=0;this.checkFlatGraph(),this.flatGraph.forEach(function(e){e.updateSortValue(),t+=e.sortValue}),this.sortValue=t/this.flatGraph.length,this.updateSort&&this.flatGraph.sort(f.shapeSorter)},z.prototype.render=function(t,e){this.visible&&(this.checkFlatGraph(),this.flatGraph.forEach(function(i){i.render(t,e)}))},z.prototype.getFlatGraph=function(){return[this]},z.prototype.updateFlatGraph=function(){var t=[];this.children.forEach(function(e){var i=e.getFlatGraph();t=t.concat(i)}),this.flatGraph=t};var P=C.subclass({width:1,height:1});P.prototype.setPath=function(){var t=this.width/2,e=this.height/2;this.path=[{x:-t,y:-e},{x:t,y:-e},{x:t,y:e},{x:-t,y:e}]};var R=C.subclass({width:1,height:1,cornerRadius:.25,closed:!1});R.prototype.setPath=function(){var t=this.width/2,e=this.height/2,i=Math.min(t,e),r=Math.min(this.cornerRadius,i),n=t-r,o=e-r,s=[{x:n,y:-e},{arc:[{x:t,y:-e},{x:t,y:-o}]}];o&&s.push({x:t,y:o}),s.push({arc:[{x:t,y:e},{x:n,y:e}]}),n&&s.push({x:-n,y:e}),s.push({arc:[{x:-t,y:e},{x:-t,y:o}]}),o&&s.push({x:-t,y:-o}),s.push({arc:[{x:-t,y:-e},{x:-n,y:-e}]}),n&&s.push({x:n,y:-e}),this.path=s},R.prototype.updateSortValue=function(){C.prototype.updateSortValue.apply(this,arguments);var t=this.pathCommands.length,e=this.pathCommands[t-1].endRenderPoint;this.sortValue-=e.z/t};var k=C.subclass({diameter:1,width:void 0,height:void 0,quarters:4,closed:!1});k.prototype.setPath=function(){var t=(null!=this.width?this.width:this.diameter)/2,e=(null!=this.height?this.height:this.diameter)/2;this.path=[{x:0,y:-e},{arc:[{x:t,y:-e},{x:t,y:0}]}],this.quarters>1&&this.path.push({arc:[{x:t,y:e},{x:0,y:e}]}),this.quarters>2&&this.path.push({arc:[{x:-t,y:e},{x:-t,y:0}]}),this.quarters>3&&this.path.push({arc:[{x:-t,y:-e},{x:0,y:-e}]})},k.prototype.updateSortValue=function(){if(C.prototype.updateSortValue.apply(this,arguments),4==this.quarters){var t=this.pathCommands.length,e=this.pathCommands[t-1].endRenderPoint;this.sortValue-=e.z/t}};var G=C.subclass({sides:3,radius:.5});G.prototype.setPath=function(){this.path=[];for(var e=0;e<this.sides;e++){var i=e/this.sides*t-t/4,r=Math.cos(i)*this.radius,n=Math.sin(i)*this.radius;this.path.push({x:r,y:n})}};var F=k.subclass({fill:!0});F.prototype.render=function(t,e){this.renderDome(t,e),k.prototype.render.apply(this,arguments)},F.prototype.renderDome=function(e,i){if(this.visible){var r=this.getDomeRenderElement(e,i),n=Math.atan2(this.renderNormal.y,this.renderNormal.x),o=this.diameter/2*this.renderNormal.magnitude(),s=this.renderOrigin.x,h=this.renderOrigin.y;if(i.isCanvas){var a=n+t/4,p=n-t/4;e.beginPath(),e.arc(s,h,o,a,p)}else i.isSvg&&(n=(n-t/4)/t*360,this.domeSvgElement.setAttribute("d","M "+-o+",0 A "+o+","+o+" 0 0 1 "+o+",0"),this.domeSvgElement.setAttribute("transform","translate("+s+","+h+" ) rotate("+n+")"));i.stroke(e,r,this.stroke,this.color,this.getLineWidth()),i.fill(e,r,this.fill,this.color),i.end(e,r)}};F.prototype.getDomeRenderElement=function(t,e){if(e.isSvg)return this.domeSvgElement||(this.domeSvgElement=document.createElementNS("http://www.w3.org/2000/svg","path"),this.domeSvgElement.setAttribute("stroke-linecap","round"),this.domeSvgElement.setAttribute("stroke-linejoin","round")),this.domeSvgElement};var M=z.subclass({color:"#333",updateSort:!0});M.prototype.create=function(){z.prototype.create.apply(this,arguments),this.pathCommands=[new x("move",[{}]),new x("line",[{}])]},M.prototype.render=function(t,e){this.renderCylinderSurface(t,e),z.prototype.render.apply(this,arguments)},M.prototype.renderCylinderSurface=function(t,e){if(this.visible){var i=this.getRenderElement(t,e),r=this.frontBase,n=this.rearBase,o=r.renderNormal.magnitude(),s=r.diameter*o+r.getLineWidth();this.pathCommands[0].renderPoints[0].set(r.renderOrigin),this.pathCommands[1].renderPoints[0].set(n.renderOrigin),e.isCanvas&&(t.lineCap="butt"),e.renderPath(t,i,this.pathCommands),e.stroke(t,i,!0,this.color,s),e.end(t,i),e.isCanvas&&(t.lineCap="round")}};M.prototype.getRenderElement=function(t,e){if(e.isSvg)return this.svgElement||(this.svgElement=document.createElementNS("http://www.w3.org/2000/svg","path")),this.svgElement},M.prototype.copyGraph=e,k.subclass().prototype.copyGraph=e;var A=C.subclass({diameter:1,length:1,frontFace:void 0,fill:!0});A.prototype.create=function(){C.prototype.create.apply(this,arguments),this.group=new M({addTo:this,color:this.color,visible:this.visible});var e=this.length/2,i=this.backface||!0;this.frontBase=this.group.frontBase=new k({addTo:this.group,diameter:this.diameter,translate:{z:e},rotate:{y:t/2},color:this.color,stroke:this.stroke,fill:this.fill,backface:this.frontFace||i,visible:this.visible}),this.rearBase=this.group.rearBase=this.frontBase.copy({translate:{z:-e},rotate:{y:0},backface:i})},A.prototype.render=function(){};["stroke","fill","color","visible"].forEach(function(t){var e="_"+t;Object.defineProperty(A.prototype,t,{get:function(){return this[e]},set:function(i){this[e]=i,this.frontBase&&(this.frontBase[t]=i,this.rearBase[t]=i,this.group[t]=i)}})});var O=k.subclass({length:1,fill:!0});O.prototype.create=function(){k.prototype.create.apply(this,arguments),this.apex=new f({addTo:this,translate:{z:this.length}}),this.renderApex=new d,this.tangentA=new d,this.tangentB=new d,this.surfacePathCommands=[new x("move",[{}]),new x("line",[{}]),new x("line",[{}])]},O.prototype.render=function(t,e){this.renderConeSurface(t,e),k.prototype.render.apply(this,arguments)},O.prototype.renderConeSurface=function(e,i){if(this.visible){this.renderApex.set(this.apex.renderOrigin).subtract(this.renderOrigin);var r=this.renderNormal.magnitude(),n=this.renderApex.magnitude2d(),o=this.renderNormal.magnitude2d(),s=Math.acos(o/r),h=Math.sin(s),a=this.diameter/2*r;if(a*h<n){var p=Math.atan2(this.renderNormal.y,this.renderNormal.x)+t/2,d=n/h,c=Math.acos(a/d),u=this.tangentA,l=this.tangentB;u.x=Math.cos(c)*a*h,u.y=Math.sin(c)*a,l.set(this.tangentA),l.y*=-1,u.rotateZ(p),l.rotateZ(p),u.add(this.renderOrigin),l.add(this.renderOrigin),this.setSurfaceRenderPoint(0,u),this.setSurfaceRenderPoint(1,this.apex.renderOrigin),this.setSurfaceRenderPoint(2,l);var f=this.getSurfaceRenderElement(e,i);i.renderPath(e,f,this.surfacePathCommands),i.stroke(e,f,this.stroke,this.color,this.getLineWidth()),i.fill(e,f,this.fill,this.color),i.end(e,f)}}};O.prototype.getSurfaceRenderElement=function(t,e){if(e.isSvg)return this.surfaceSvgElement||(this.surfaceSvgElement=document.createElementNS("http://www.w3.org/2000/svg","path"),this.surfaceSvgElement.setAttribute("stroke-linecap","round"),this.surfaceSvgElement.setAttribute("stroke-linejoin","round")),this.surfaceSvgElement},O.prototype.setSurfaceRenderPoint=function(t,e){this.surfacePathCommands[t].renderPoints[0].set(e)};var D=P.subclass();D.prototype.copyGraph=function(){};var L=i({width:1,height:1,depth:1,frontFace:!0,rearFace:!0,leftFace:!0,rightFace:!0,topFace:!0,bottomFace:!0},C.defaults);L.fill=!0,delete L.path;var V=f.subclass(L);return V.prototype.create=function(t){f.prototype.create.call(this,t),this.updatePath()},V.prototype.updatePath=function(){this.setFace("frontFace",{width:this.width,height:this.height,translate:{z:this.depth/2}}),this.setFace("rearFace",{width:this.width,height:this.height,translate:{z:-this.depth/2},rotate:{y:t/2}}),this.setFace("leftFace",{width:this.depth,height:this.height,translate:{x:-this.width/2},rotate:{y:-t/4}}),this.setFace("rightFace",{width:this.depth,height:this.height,translate:{x:this.width/2},rotate:{y:t/4}}),this.setFace("topFace",{width:this.width,height:this.depth,translate:{y:-this.height/2},rotate:{x:-t/4}}),this.setFace("bottomFace",{width:this.width,height:this.depth,translate:{y:this.height/2},rotate:{x:-t/4}})},V.prototype.setFace=function(t,e){var r=this[t],n=t+"Rect",o=this[n];r?(i(e,{color:"string"==typeof r?r:this.color,stroke:this.stroke,fill:this.fill,backface:this.backface,front:this.front,visible:this.visible}),o?o.setOptions(e):o=this[n]=new D(e),o.updatePath(),this.addChild(o)):this.removeChild(o)},{TAU:t,extend:i,lerp:r,modulo:n,easeInOut:function(t,e){if(1==e)return t;var i=(t=Math.max(0,Math.min(1,t)))<.5,r=i?t:1-t,n=(o[e]||o[2])(r/=.5);return n/=2,i?n:1-n},CanvasRenderer:s,SvgRenderer:h,Vector:d,Anchor:f,Dragger:m,Illustration:w,PathCommand:x,Shape:C,Group:z,Rect:P,RoundedRect:R,Ellipse:k,Polygon:G,Hemisphere:F,Cylinder:A,Cone:O,Box:V}});
